#String Oriented Programming
##Circumventing ASLR, DEP, and Other Guards
https://events.ccc.de/congress/2011/Fahrplan/attachments/1972_28c3-SOP-payerm.pdf

###摘要

软件保护机制的趋势不断变化，开拓日益复杂。
开拓生成工具可以用于建造对于开拓使用已知算法的特定软件。文中提出了如此利用格式字符串的算法,并介绍面向字符串编程（SOP)
SOP将格式字符串开拓升级到上一级，而且转换了执行任意代码的开拓入侵载体的方向。和ROP、JOP类似SOP不依赖现有的代码，然而联系于使用静态程序分析的软件里的gadgets。
文章首先说明现有的攻击方法，如代码注入、ROP、JOP、格式化字符串攻击。该攻击均依赖于控制流的重定向或者代码（即处于可执行的呢寸领域）。

###该攻击方法的简单说明如下。

- 代码注入
该攻击通过添加额外的代码展开，攻击者经常通过缓存溢出将可输入的代码（如shell code）注入进去并执行。
-返回导向编程(ROP)
该攻击通过覆盖返回地址的方法展开，攻击者通过栈溢出覆盖返回地址改成gadget（即其他上下文里的可执行代码片）的地址，因此可以执行任意代码。
- 跳的面向对象编程(JOP)
该攻击与ROP相似，区别在于不限制何处（即均可进行栈溢出、堆溢出）进行缓存溢出，然而通过使用间接地址转换控制流。
-各式字符串攻击（SOP)
该攻击通过输入格式字符串的方法展开，由于printf_family函数允许攻击者输入的字符串直接通过近去内存里，因此攻击者利用其特点输入可以操作内存的格式字符串，如%S、%T。

随着攻击方法不断发展，防御机制也日益精巧，防御机制通过如下的方法防止上述攻击。
- 检查站的完整性
- 验证库的使用
- 加密指针
- 改变指令集
- 保护格式字符串
- 随机随机存储器位置
- 检查并验证使控制流改变的每一指令

###一般情况下目前的计算机都开着一些防御机制，如DEP、ASLR、ProPolice,简单介绍功能如下。

- Data Execution Prevention(DEP):该机制通过限制可执行代码的内存领域防止攻击，因此攻击者的代码不能在随地（内存）执行。
- Address Space Layout Randomization(ASLR):该机制通过将应用的动态数据（如动态加载的库、堆、栈）随机化的方法防止攻击。
- Stack-Smashing Protector(SSP,文中的ProPolice):该机制编译时比较开始和结束阶段之间的canary（即返回地址前边插如的一种检查字节），保护函数内的所有值，整列指针和变量并保存函数里的因素。

###各种情况（各种防御机制）下进行试验的结果如下。

- 没有防御机制：可以进行简单的注入代码攻击。
- DEP:可以通过缓存溢出展开ROP攻击。
- DEP、ProPolice：可以展开格式字符串攻击重定向控制流。
- ASLR, DEP, ProPolice, imports available: 假设指定的软件加载攻击者所需要的库，其情况下可以展开SOP。
- ASLR, DEP, ProPolice, no imports available:由于无法调用攻击者需要的代码片或者函数，因此不能展开攻击。

###结论

上述技术的结合使SOP可以绕过目前常用的防御机制，如ASLR、 DEP、ProPolice以及另外限制攻击的机制。SOP使现有的攻击（如ROP、JOP）在没有注入任何代码的星狂下，可以执行任意代码。

